tinymce.PluginManager.add('imageuploader', function (editor, url) {
    // Add a button that opens a window
    editor.addButton('imageuploader', {
        text: 'Image',
        icon: 'image',
        onclick: function () {
            // Open window
            editor.windowManager.open({
                title: 'Upload image',
                url: actionExample,
                buttons: [{
                    text: 'Submit',
                    onclick: 'submit'
                }, {
                    text: 'Cancel',
                    onclick: 'close'
                }],
                width: 800,
                height: 600,
                onsubmit: function (e) {
                    var tooltip= $('iframe').contents().find('#tooltip').attr('value');
                    var newMedia = $('iframe').contents().find('#media-url');
                    var url = $('iframe').contents().find('#uploadImage');
                    var type = newMedia.attr('data-media-type');
                    if (url.length > 0) {

                        if (type == 'image') {
                            editor.insertContent('<img src="' + url.attr('src') + '" + title="' + tooltip+ '"/>');
                            return true;
                        }

                    } else {
                        alert(' You must upload a picture!');
                        return false;
                    }
                }
            });
        }
    });


});
